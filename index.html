<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –í–∞—à–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            line-height: 1.5;
        }
        .container { max-width: 500px; margin: 0 auto; }
        .user-info { background: var(--tg-theme-secondary-bg-color, #f0f0f0); padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 14px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        textarea { width: 100%; min-height: 100px; padding: 10px; border: 1px solid var(--tg-theme-hint-color, #999); border-radius: 8px; resize: vertical; font-family: inherit; background: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); }
        .buttons-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { flex: 1; min-width: 120px; padding: 12px 20px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: var(--tg-theme-button-color, #2481cc); color: var(--tg-theme-button-text-color, #fff); }
        .btn-secondary { background: var(--tg-theme-secondary-bg-color, #f0f0f0); color: var(--tg-theme-text-color, #000); }
        .btn-success { background: #28a745; color: white; }
        .status { padding: 10px; border-radius: 5px; margin-top: 15px; text-align: center; display: none; }
        .success { background: #d4edda; color: #155724; display: block; }
        .error { background: #f8d7da; color: #721c24; display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏</h1>
        <div class="user-info">
            <strong>–í–∞—à ID:</strong> <span id="user-id">–∑–∞–≥—Ä—É–∑–∫–∞...</span><br>
            <strong>–ò–º—è:</strong> <span id="user-name">–∑–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>

        <form id="feedback-form">
            <div class="form-group">
                <label for="message">–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                <textarea id="message" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –æ—Ç–∑—ã–≤, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å..." required></textarea>
            </div>

            <div class="form-group">
                <label>–¢–∏–ø –æ–±—Ä–∞—â–µ–Ω–∏—è:</label>
                <div class="buttons-group">
                    <button type="button" class="btn btn-primary" data-type="question">‚ùì –í–æ–ø—Ä–æ—Å</button>
                    <button type="button" class="btn btn-secondary" data-type="suggestion">üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
                    <button type="button" class="btn btn-secondary" data-type="problem">‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞</button>
                </div>
            </div>

            <div class="form-group">
                <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                <div class="buttons-group">
                    <button type="button" class="btn btn-secondary" data-priority="low">üü¢ –ù–∏–∑–∫–∏–π</button>
                    <button type="button" class="btn btn-secondary" data-priority="medium">üü° –°—Ä–µ–¥–Ω–∏–π</button>
                    <button type="button" class="btn btn-primary" data-priority="high">üî¥ –í—ã—Å–æ–∫–∏–π</button>
                </div>
            </div>

            <div class="buttons-group">
                <button type="submit" class="btn btn-success">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button type="button" class="btn btn-secondary" id="close-btn">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </form>

        <div id="status" class="status"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.enableClosingConfirmation();

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe && tg.initDataUnsafe.user;
        document.getElementById('user-id').textContent = user ? user.id : '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ';
        document.getElementById('user-name').textContent = user ? `${user.first_name}${user.last_name ? ' ' + user.last_name : ''}` : '–ê–Ω–æ–Ω–∏–º';

        if (user) {
            document.querySelector('h1').textContent = `üìù –§–æ—Ä–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –¥–ª—è ${user.first_name}`;
        }

        let selectedType = 'question';
        let selectedPriority = 'high';

        document.querySelectorAll('[data-type]').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedType = btn.dataset.type;
                updateActiveButtons('[data-type]', btn);
            });
        });

        document.querySelectorAll('[data-priority]').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedPriority = btn.dataset.priority;
                updateActiveButtons('[data-priority]', btn);
            });
        });

        function updateActiveButtons(selector, activeBtn) {
            document.querySelectorAll(selector).forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            activeBtn.classList.remove('btn-secondary');
            activeBtn.classList.add('btn-primary');
        }

        // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ß–ê–°–¢–¨: –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Backend API
        document.getElementById('feedback-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const message = document.getElementById('message').value.trim();

            if (!message) {
                showStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ', 'error');
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const formData = {
                user_id: user?.id,
                user_name: user?.first_name + (user?.last_name ? ' ' + user?.last_name : ''),
                message: message,
                type: selectedType,
                priority: selectedPriority,
                timestamp: new Date().toISOString(),
                // –î–æ–±–∞–≤–ª—è–µ–º initData –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                initData: tg.initData
            };

            try {
                showStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...', 'success');
                
                // üî• –û–¢–ü–†–ê–í–ö–ê –ù–ê BACKEND –≤–º–µ—Å—Ç–æ tg.sendData()
                const response = await fetch('https://your-backend.com/api/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    showStatus('‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ó–∞–∫—Ä—ã–≤–∞—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...', 'success');
                    setTimeout(() => tg.close(), 2000);
                } else {
                    throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'error');
            }
        });

        document.getElementById('close-btn').addEventListener('click', () => {
            tg.close();
        });

        function showStatus(text, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = `status ${type}`;
        }

        updateActiveButtons('[data-type]', document.querySelector('[data-type="question"]'));
        updateActiveButtons('[data-priority]', document.querySelector('[data-priority="high"]'));
    </script>
</body>
</html>
