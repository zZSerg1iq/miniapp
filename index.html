<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–ø–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #000000;
            line-height: 1.5;
            padding: 20px;
            min-height: 100vh;
            overflow-y: auto;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 14px;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }

        .buttons-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stage-content {
            display: none;
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 16px;
            margin-bottom: 10px;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
        }

        .answer-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .answer-option input[type="text"] {
            flex: 1;
            margin-right: 10px;
            margin-bottom: 0;
        }

        .map-container {
            height: 300px;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            position: relative;
        }

        .map-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #dc3545;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
        }

        .map-instructions {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }

        .status {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .btn {
                font-size: 14px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning-banner">
            ‚ö†Ô∏è –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ –∏–∑ Telegram, –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram.
        </div>

        <h1>üìù –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ç–∞–ø–∞</h1>

        <div class="user-info">
            <strong>–í–∞—à ID:</strong> <span id="user-id">–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω</span><br>
            <strong>–ò–º—è:</strong> <span id="user-name">–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ</span><br>
            <strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platform-info">–ø—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>

        <div class="form-group">
            <div class="section-title">*–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —ç—Ç–∞–ø–∞*</div>
            <div class="buttons-group">
                <button type="button" class="btn btn-secondary" data-type="message">üì® –°–æ–æ–±—â–µ–Ω–∏–µ</button>
                <button type="button" class="btn btn-secondary" data-type="quiz">‚ùì –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</button>
                <button type="button" class="btn btn-secondary" data-type="geo">üìç –ì–µ–æ —Ç–æ—á–∫–∞</button>
                <button type="button" class="btn btn-secondary" data-type="riddle">üîç –ó–∞–≥–∞–¥–∫–∞</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–∏–ø–∞ "–°–æ–æ–±—â–µ–Ω–∏–µ" -->
        <div id="message-content" class="stage-content">
            <div class="form-group">
                <label for="message-text">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:</label>
                <textarea 
                    id="message-text" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..." 
                    rows="5"
                ></textarea>
            </div>
            <button type="button" class="btn btn-success" id="send-message-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–∏–ø–∞ "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞" -->
        <div id="quiz-content" class="stage-content">
            <div class="form-group">
                <label for="quiz-question">–í–æ–ø—Ä–æ—Å:</label>
                <input type="text" id="quiz-question" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã...">
            </div>
            
            <div class="form-group">
                <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤:</label>
                <div id="answer-options">
                    <div class="answer-option">
                        <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 1" class="quiz-answer">
                        <input type="checkbox" class="correct-answer">
                        <label>–í–µ—Ä–Ω—ã–π</label>
                    </div>
                    <div class="answer-option">
                        <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ 2" class="quiz-answer">
                        <input type="checkbox" class="correct-answer">
                        <label>–í–µ—Ä–Ω—ã–π</label>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" id="add-option-btn">+ –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>
            </div>
            
            <button type="button" class="btn btn-success" id="send-quiz-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–∏–ø–∞ "–ì–µ–æ —Ç–æ—á–∫–∞" -->
        <div id="geo-content" class="stage-content">
            <div class="map-container" id="map">
                <div class="map-instructions">
                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∫—É
                </div>
            </div>
            <div class="form-group">
                <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</label>
                <input type="text" id="coordinates" placeholder="–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–æ—á–∫–∏" readonly>
            </div>
            <button type="button" class="btn btn-success" id="send-geo-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —Ç–∏–ø–∞ "–ó–∞–≥–∞–¥–∫–∞" -->
        <div id="riddle-content" class="stage-content">
            <div class="form-group">
                <label for="riddle-text">–¢–µ–∫—Å—Ç –∑–∞–≥–∞–¥–∫–∏:</label>
                <textarea 
                    id="riddle-text" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–∞–≥–∞–¥–∫–∏..." 
                    rows="5"
                ></textarea>
            </div>
            <div class="form-group">
                <label for="riddle-answer">–û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–≥–∞–¥–∫—É:</label>
                <input type="text" id="riddle-answer" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç...">
            </div>
            <button type="button" class="btn btn-success" id="send-riddle-btn" disabled>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>

        <div id="status" class="status"></div>
    </div>

    <script>
        // üöÄ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function initializeApp() {
            const tg = window.Telegram?.WebApp;
            
            if (tg) {
                try {
                    tg.expand();
                    tg.enableClosingConfirmation();
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const user = tg.initDataUnsafe?.user;
                    const userId = user?.id || '–ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ';
                    const userName = user ? 
                        `${user.first_name || ''}${user.last_name ? ' ' + user.last_name : ''}`.trim() : 
                        '–ê–Ω–æ–Ω–∏–º';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    document.getElementById('user-id').textContent = userId;
                    document.getElementById('user-name').textContent = userName;
                    document.getElementById('platform-info').textContent = 
                        `${tg.platform} ‚Ä¢ ${tg.colorScheme} —Ç–µ–º–∞`;
                    
                    console.log('Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                    return tg;
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp:', error);
                    return null;
                }
            } else {
                document.getElementById('platform-info').textContent = '–ë—Ä–∞—É–∑–µ—Ä (–≤–Ω–µ Telegram)';
                return null;
            }
        }

        // üìù –õ–æ–≥–∏–∫–∞ —Ñ–æ—Ä–º—ã
        let selectedType = null;
        let markerCoordinates = null;
        let answerOptionsCount = 2;

        function showStatus(text, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }

        function hideAllStageContent() {
            document.querySelectorAll('.stage-content').forEach(el => {
                el.style.display = 'none';
            });
        }

        function updateActiveButtons() {
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            
            if (selectedType) {
                const activeBtn = document.querySelector(`[data-type="${selectedType}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('btn-secondary');
                    activeBtn.classList.add('btn-primary');
                }
            }
        }

        function showStageContent(type) {
            hideAllStageContent();
            const contentEl = document.getElementById(`${type}-content`);
            if (contentEl) {
                contentEl.style.display = 'block';
            }
        }

        function validateMessageForm() {
            const messageText = document.getElementById('message-text').value.trim();
            const sendBtn = document.getElementById('send-message-btn');
            sendBtn.disabled = !messageText;
        }

        function validateQuizForm() {
            const question = document.getElementById('quiz-question').value.trim();
            const answers = document.querySelectorAll('.quiz-answer');
            let hasAnswers = false;
            let hasCorrect = false;
            
            answers.forEach(answer => {
                if (answer.value.trim()) {
                    hasAnswers = true;
                    const checkbox = answer.parentElement.querySelector('.correct-answer');
                    if (checkbox.checked) {
                        hasCorrect = true;
                    }
                }
            });
            
            const sendBtn = document.getElementById('send-quiz-btn');
            sendBtn.disabled = !(question && hasAnswers && hasCorrect);
        }

        function addAnswerOption() {
            if (answerOptionsCount >= 10) return;
            
            answerOptionsCount++;
            const optionsContainer = document.getElementById('answer-options');
            const newOption = document.createElement('div');
            newOption.className = 'answer-option';
            newOption.innerHTML = `
                <input type="text" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ ${answerOptionsCount}" class="quiz-answer">
                <input type="checkbox" class="correct-answer">
                <label>–í–µ—Ä–Ω—ã–π</label>
            `;
            optionsContainer.appendChild(newOption);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π
            newOption.querySelector('.quiz-answer').addEventListener('input', validateQuizForm);
            newOption.querySelector('.correct-answer').addEventListener('change', validateQuizForm);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º
            if (answerOptionsCount >= 10) {
                document.getElementById('add-option-btn').disabled = true;
            }
        }

        function initMap() {
            const map = document.getElementById('map');
            const coordinatesInput = document.getElementById('coordinates');
            const sendBtn = document.getElementById('send-geo-btn');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–∞—Ä—Ç–µ
            map.addEventListener('click', function(e) {
                // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –º–µ—Ç–∫—É
                const existingMarker = document.querySelector('.map-marker');
                if (existingMarker) {
                    existingMarker.remove();
                }
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–µ—Ç–∫—É
                const marker = document.createElement('div');
                marker.className = 'map-marker';
                marker.style.left = e.offsetX + 'px';
                marker.style.top = e.offsetY + 'px';
                map.appendChild(marker);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
                markerCoordinates = {
                    x: e.offsetX,
                    y: e.offsetY
                };
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                coordinatesInput.value = `X: ${e.offsetX}, Y: ${e.offsetY}`;
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
                sendBtn.disabled = false;
            });
        }

        function validateRiddleForm() {
            const riddleText = document.getElementById('riddle-text').value.trim();
            const riddleAnswer = document.getElementById('riddle-answer').value.trim();
            const sendBtn = document.getElementById('send-riddle-btn');
            sendBtn.disabled = !(riddleText && riddleAnswer);
        }

        function sendData(data) {
            const tg = window.Telegram?.WebApp;
            
            if (tg) {
                try {
                    showStatus('–û—Ç–ø—Ä–∞–≤–∫–∞...', 'loading');
                    tg.sendData(JSON.stringify(data));
                    showStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!', 'success');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                    showStatus('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'error');
                }
            } else {
                showStatus('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ (–≤–Ω–µ Telegram)', 'success');
                console.log('–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:', data);
            }
        }

        // üéØ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const tg = initializeApp();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —ç—Ç–∞–ø–∞
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedType = btn.dataset.type;
                    updateActiveButtons();
                    showStageContent(selectedType);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º—ã "–°–æ–æ–±—â–µ–Ω–∏–µ"
            document.getElementById('message-text').addEventListener('input', validateMessageForm);
            document.getElementById('send-message-btn').addEventListener('click', () => {
                const data = {
                    type: 'message',
                    text: document.getElementById('message-text').value.trim(),
                    timestamp: new Date().toISOString()
                };
                sendData(data);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º—ã "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞"
            document.getElementById('quiz-question').addEventListener('input', validateQuizForm);
            document.querySelectorAll('.quiz-answer').forEach(input => {
                input.addEventListener('input', validateQuizForm);
            });
            document.querySelectorAll('.correct-answer').forEach(checkbox => {
                checkbox.addEventListener('change', validateQuizForm);
            });
            document.getElementById('add-option-btn').addEventListener('click', addAnswerOption);
            document.getElementById('send-quiz-btn').addEventListener('click', () => {
                const question = document.getElementById('quiz-question').value.trim();
                const answers = [];
                
                document.querySelectorAll('.answer-option').forEach(option => {
                    const answerText = option.querySelector('.quiz-answer').value.trim();
                    const isCorrect = option.querySelector('.correct-answer').checked;
                    
                    if (answerText) {
                        answers.push({
                            text: answerText,
                            correct: isCorrect
                        });
                    }
                });
                
                const data = {
                    type: 'quiz',
                    question: question,
                    answers: answers,
                    timestamp: new Date().toISOString()
                };
                sendData(data);
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –¥–ª—è "–ì–µ–æ —Ç–æ—á–∫–∏"
            initMap();
            document.getElementById('send-geo-btn').addEventListener('click', () => {
                const data = {
                    type: 'geo',
                    coordinates: markerCoordinates,
                    timestamp: new Date().toISOString()
                };
                sendData(data);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–æ—Ä–º—ã "–ó–∞–≥–∞–¥–∫–∞"
            document.getElementById('riddle-text').addEventListener('input', validateRiddleForm);
            document.getElementById('riddle-answer').addEventListener('input', validateRiddleForm);
            document.getElementById('send-riddle-btn').addEventListener('click', () => {
                const data = {
                    type: 'riddle',
                    text: document.getElementById('riddle-text').value.trim(),
                    answer: document.getElementById('riddle-answer').value.trim(),
                    timestamp: new Date().toISOString()
                };
                sendData(data);
            });
        });
    </script>
</body>
</html>
